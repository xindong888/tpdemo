<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<!--suppress ALL -->
<html>
<head>
    <meta charset="utf-8">
    <meta content="webkit|ie-comp|ie-stand" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"
          name="viewport"/>
    <meta content="no-siteapp" http-equiv="Cache-Control"/>
    <link href="/favicon.ico" rel="Bookmark">
    <link href="/favicon.ico" rel="Shortcut Icon"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="lib/html5shiv.js"></script>
    <script type="text/javascript" src="lib/respond.min.js"></script>

    <![endif]-->
    <link href="static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css"/>
    <link href="static/h-ui.admin/css/H-ui.admin.css" rel="stylesheet" type="text/css"/>
    <link href="lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css"/>

    <link href="static/h-ui.admin/skin/default/skin.css" id="skin" rel="stylesheet" type="text/css"/>
    <link href="static/h-ui.admin/css/style.css" rel="stylesheet" type="text/css"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <!--/meta 作为公共模版分离出去-->

    <link href="lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css"/>

</head>
<body>
<div class="page-container">
    <form action="save" class="form form-horizontal" id="form-column-type-add" method="post">
        <input id="id" name="id" type="hidden">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>栏目标题：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input class="input-text" id="name" name="name" placeholder="请输入栏目的标题" type="text" value="">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2" for="type"><span class="c-red">*</span>栏目模板：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <span class="select-box">
                    <select class="select" id="type" name="type">
                    </select>
				</span>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2" for="intro"><span class="c-red">*</span>栏目摘要：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <textarea class="textarea" cols="" datatype="*10-100" dragonfly="true" id="intro" name="intro"
                          nullmsg="备注不能为空！"
                          onKeyUp="$('#intro').Huitextarealength({maxlength:200})"
                          placeholder="说点什么...最少输入10个字符"
                          rows=""></textarea>
                <p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2" for="pic"><span class="c-red">*</span>缩略图：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input id="pic" name="pic" style="display: none" type="text">
                <input id="ue1" name="none" style="display: none;">
                <div class="uploader-thum-container" id="preview">
                    <img alt="缩略图" class="thumbnail img-zoomable" id="tp"
                         src="#" style="width: 200px;
                         display: none;
                         margin-bottom: 10px;
                         cursor:pointer;">
                </div>
                <a class="btn btn-primary radius ml-10" id="btnStar">上传缩略图</a>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2" for="content">栏目说明：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <textarea id="content" name="content" style="width:100%;height:400px;"></textarea>
            </div>
        </div>
        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                <button class="btn btn-secondary radius" onClick="column_save();" type="submit"><i
                        class="Hui-iconfont">&#xe632;</i> 保存
                </button>
                <button class="btn btn-default radius" onClick="layer_close();" type="button">
                    &nbsp;&nbsp;取消&nbsp;&nbsp;
                </button>
            </div>
        </div>
    </form>
</div>

<!--_footer 作为公共模版分离出去-->
<script src="lib/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
<script src="lib/layer/2.4/layer.js" type="text/javascript"></script>
<script src="static/h-ui/js/H-ui.min.js" type="text/javascript"></script>
<script src="static/h-ui.admin/js/H-ui.admin.js" type="text/javascript"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script src="lib/My97DatePicker/4.8/WdatePicker.js" type="text/javascript"></script>
<script src="lib/jquery.validation/1.14.0/jquery.validate.js" type="text/javascript"></script>
<script src="lib/jquery.validation/1.14.0/validate-methods.js" type="text/javascript"></script>
<script src="lib/jquery.validation/1.14.0/messages_zh.js" type="text/javascript"></script>
<script src="lib/webuploader/0.1.5/webuploader.min.js" type="text/javascript"></script>
<script src="lib/ueditor/1.4.3/ueditor.config.js" type="text/javascript"></script>
<script src="lib/ueditor/1.4.3/ueditor.all.min.js" type="text/javascript"></script>
<script src="lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js" type="text/javascript"></script>
<script src="/js/view-image.min.js" type="text/javascript"></script>
<script src="/js/tools.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        /*父窗口传入过来的数据*/
        var obj = parent.obj;
        if (obj !== null) {
            /*把数据填入到表单*/
            for (var key in obj) {
                var s;
                if (key == 'content') {
                    //转义成html代码
                    s = unescapeHTML(obj[key])
                } else {
                    s = obj[key]
                }
                $("#" + key).val(s)
            }
            /*把图片地址填入到图片元素*/
            $("#tp").attr("src", obj.pic).css("display", "block")
            /*设置图缩放*/
            $.viewImage({
                target: '#tp',
                delay: 10
            })
        }
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });
        var ue = UE.getEditor('content');
        /*建立百度编辑器实例*/
        var ue1 = UE.getEditor('ue1')
        /*打开百度编辑器的插入图片对话框*/
        $('#btnStar').click(function () {
            var dialog = ue1.getDialog('insertimage');
            dialog.title = '选择缩略图';
            dialog.render();
            dialog.open();
        })
        /*当百度编辑器加载完成*/
        ue1.ready(function () {
            /*插入图片对话框的关闭事件*/
            ue1.addListener('beforeInsertImage', function (t, args) {
                /*传递到服务端的字段值*/
                $("#pic").val(args[0].src)
                //显示缩略图
                $("#tp").attr("src", args[0].src).css("display", "block")
                /*缩放图片显示*/
                $.viewImage({
                    target: '#tp',
                    delay: 10
                })
                /*因为是必填字段,如果给值,则隐藏验证错误*/
                $("#pic-error").css("display", "none")
            });
        });
        /*获取列表模板*/
        $.getJSON(
            "/admin.ColumnTypeTemplate/getColumn?type=列表模板",
            function (data) {
                /*把数据填入到选择框内*/
                for (var i = 0; i < data.length; i++) {
                    /*如果obj为空,表示父窗口没有传值过来,就是新建,如果不为空,表示不为空,就是更新*/
                    if (obj != null && data[i].id == obj.type) {
                        /*设置要编辑的数据为选择状态*/
                        $("#type").append("<option selected value='" + data[i].id + "'>" + data[i].name + "</option>")
                    } else {
                        $("#type").append("<option value='" + data[i].id + "'>" + data[i].name + "</option>")
                    }
                }
            }
        )
    });

    /*存储栏目*/
    function column_save() {
        $("#form-column-type-add").validate({
            ignore: [],
            rules: {
                name: {
                    required: true,
                    minlength: 2,
                    maxlength: 16
                },
                pic: {
                    required: true
                },
                intro: {
                    required: true,
                    minlength: 10,
                    maxlength: 200
                },
                type: {
                    required: true
                }
            },
            messages: {
                type: '请先到模板管理里的列表模板里添加模板!',
                pic: '请选择或者上传缩略图'
            },
            onkeyup: false,
            focusCleanup: true,
            success: "valid",
            submitHandler: function (form) {
                $(form).ajaxSubmit({
                    success: function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.refresh();
                        parent.layer.close(index);
                    }
                });
                $(form).resetForm()
            }
        });
    }
</script>
</body>
</html>